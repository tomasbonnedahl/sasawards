import json
from unittest import TestCase

import datetime

from sas_api.flight_getter import ResponseParser


class TestParser(TestCase):
    def setUp(self):
        pass

    def test_parse_normal(self):
        input ='''{"pricingType":"C","outboundFlights":{"F0":{"id":0,"origin":{"code":"CPH","name":"Kastrup"},"destination":{"code":"PVG","name":"Pudong  "},"originCountry":{"code":"DK","name":"Denmark"},"destinationCountry":{"code":"CN","name":"China"},"originCity":{"code":"CPH","name":"Copenhagen"},"destinationCity":{"code":"SHA","name":"Shanghai"},"connectionDuration":"10:15:00","startTimeInLocal":"2019-10-02T18:40:00.000+02:00","startTimeInGmt":"2019-10-02T16:40:00.000Z","endTimeInLocal":"2019-10-03T10:55:00.000+08:00","endTimeInGmt":"2019-10-03T02:55:00.000Z","stops":0,"segments":[{"id":11,"arrivalTerminal":"2","arrivalDateTimeInLocal":"2019-10-03T10:55:00.000+08:00","arrivalDateTimeInGmt":"2019-10-03T02:55:00.000Z","departureTerminal":"3","departureDateTimeInLocal":"2019-10-02T18:40:00.000+02:00","departureDateTimeInGmt":"2019-10-02T16:40:00.000Z","departureAirport":{"code":"CPH","name":"Kastrup"},"arrivalAirport":{"code":"PVG","name":"Pudong  "},"departureCity":{"code":"CPH","name":"Copenhagen"},"arrivalCity":{"code":"SHA","name":"Shanghai"},"departureCountry":{"code":"DK","name":"Denmark"},"arrivalCountry":{"code":"CN","name":"China"},"airCraft":{"code":"343","name":"Airbus Industrie A340-300"},"flightNumber":"997","duration":"10:15:00","marketingCarrier":{"code":"SK","name":"Scandinavian Airlines"},"onTimePerformance":0.0,"miles":0,"numberOfStops":0}],"cabins":{"BUSINESS":{"SAS BUSINESS":{"products":{"O_2":{"productName":"SAS BUSINESS","productCode":"EBSARB","lowestFare":true,"recommendations":[1],"price":{"currency":"NOK","basePrice":0.0,"totalTax":428.0,"totalPrice":428.0,"formattedTotalTax":"428,-","formattedTotalPrice":"428,-","points":120000,"credits":0,"pricePerPassengerType":[{"id":1,"type":"ADT","numberCount":2,"price":{"currency":"NOK","basePrice":0.0,"totalTax":214.0,"totalPrice":214.0,"formattedTotalTax":"214,-","formattedTotalPrice":"214,-","points":60000,"credits":0}}]},"fares":[{"segmentId":"11","fareClass":"IBP00","bookingClass":"I","avlSeats":2}],"fareKey":"I","flyingToOrOverRussia":true}}}},"PLUS":{"SAS PLUS":{"products":{"O_1":{"productName":"SAS PLUS","productCode":"EBSARP","lowestFare":true,"recommendations":[0],"price":{"currency":"NOK","basePrice":0.0,"totalTax":428.0,"totalPrice":428.0,"formattedTotalTax":"428,-","formattedTotalPrice":"428,-","points":96000,"credits":0,"pricePerPassengerType":[{"id":1,"type":"ADT","numberCount":2,"price":{"currency":"NOK","basePrice":0.0,"totalTax":214.0,"totalPrice":214.0,"formattedTotalTax":"214,-","formattedTotalPrice":"214,-","points":48000,"credits":0}}]},"fares":[{"segmentId":"11","fareClass":"XFBP00","bookingClass":"F","avlSeats":2}],"fareKey":"F","flyingToOrOverRussia":true}}}}},"lowestFares":{"BUSINESS":{"product":"SAS BUSINESS","productId":"O_2","avlSeats":2,"points":60000.0},"PLUS":{"product":"SAS PLUS","productId":"O_1","avlSeats":2,"points":48000.0}}}},"productInfo":{"BUSINESS":{"1":"SAS BUSINESS"},"PLUS":{"1":"SAS PLUS"}},"tabsInfo":{"outboundInfo":[{"date":"2019-10-01","price":"214,-","points":48000.0},{"date":"2019-10-02","price":"214,-","points":48000.0},{"date":"2019-10-03","price":"214,-","points":48000.0}]},"currency":{"code":"NOK","name":"Norwegian Krone","symbol":",-","decimalSeperator":".","position":"Suffix","currencyDelimiter":"space"},"links":[{"rel":"GetEBMSPoints","href":"/offers/flightproducts/getAccrualPoints"},{"rel":"FareReview","href":"/offers/flightproducts/getFare"},{"rel":"InitiateCheckout","href":"/checkout/initiate"}],"regionName":"EB Intercont","offerId":"420e12aa-c1cd-485a-a67c-9af7074d445f_2018-11-16","outboundLowestFare":{"product":"SAS PLUS","productId":"O_1","avlSeats":2,"points":48000.0,"cabinName":"PLUS","flightId":"F0"},"isOutboundIntercontinental":true}'''

        extracted = ResponseParser(json.loads(input)).parse()
        assert extracted.origin == 'CPH'
        assert extracted.destination == 'PVG'
        assert extracted.business_seats == 2
        assert extracted.date == datetime.date(2019, 10, 2)

    def test_parse_pricing_type_O(self):
        input = '''{"pricingType": "O", "outboundFlights": {"F3": {"id": 3, "origin": {"code": "CPH", "name": "Kastrup"}, "destination": {"code": "PVG", "name": "Pudong  "}, "originCountry": {"code": "DK", "name": "Denmark"}, "destinationCountry": {"code": "CN", "name": "China"}, "originCity": {"code": "CPH", "name": "Copenhagen"}, "destinationCity": {"code": "SHA", "name": "Shanghai"}, "connectionDuration": "10:15:00", "startTimeInLocal": "2019-10-02T18:40:00.000+02:00", "startTimeInGmt": "2019-10-02T16:40:00.000Z", "endTimeInLocal": "2019-10-03T10:55:00.000+08:00", "endTimeInGmt": "2019-10-03T02:55:00.000Z", "stops": 0, "segments": [{"id": 11, "arrivalTerminal": "2", "arrivalDateTimeInLocal": "2019-10-03T10:55:00.000+08:00", "arrivalDateTimeInGmt": "2019-10-03T02:55:00.000Z", "departureTerminal": "3", "departureDateTimeInLocal": "2019-10-02T18:40:00.000+02:00", "departureDateTimeInGmt": "2019-10-02T16:40:00.000Z", "departureAirport": {"code": "CPH", "name": "Kastrup"}, "arrivalAirport": {"code": "PVG", "name": "Pudong  "}, "departureCity": {"code": "CPH", "name": "Copenhagen"}, "arrivalCity": {"code": "SHA", "name": "Shanghai"}, "departureCountry": {"code": "DK", "name": "Denmark"}, "arrivalCountry": {"code": "CN", "name": "China"}, "airCraft": {"code": "343", "name": "Airbus Industrie A340-300"}, "flightNumber": "997", "duration": "10:15:00", "marketingCarrier": {"code": "SK", "name": "Scandinavian Airlines"}, "onTimePerformance": 0.0, "miles": 0, "numberOfStops": 0}], "cabins": {"GO": {"SAS GO FLEX": {"products": {"O_1": {"productName": "SAS GO FLEX", "productCode": "ECOB", "lowestFare": true, "recommendations": [3], "price": {"currency": "SEK", "basePrice": 11472.0, "totalTax": 1770.0, "totalPrice": 13242.0, "formattedBasePrice": "11472:-", "formattedTotalTax": "1770:-", "formattedTotalPrice": "13242:-", "points": 0, "credits": 0, "pricePerPassengerType": [{"id": 1, "type": "ADT", "numberCount": 1, "price": {"currency": "SEK", "basePrice": 11472.0, "totalTax": 1770.0, "totalPrice": 13242.0, "formattedBasePrice": "11472:-", "formattedTotalTax": "1770:-", "formattedTotalPrice": "13242:-", "points": 0, "credits": 0}}]}, "fares": [{"segmentId": "11", "fareClass": "EDKOW", "bookingClass": "E", "avlSeats": 9}], "fareKey": "E", "flyingToOrOverRussia": true}}}}, "BUSINESS": {"SAS BUSINESS": {"products": {"O_3": {"productName": "SAS BUSINESS", "productCode": "BUSA", "lowestFare": true, "recommendations": [5], "price": {"currency": "SEK", "basePrice": 34347.0, "totalTax": 1880.0, "totalPrice": 36227.0, "formattedBasePrice": "34347:-", "formattedTotalTax": "1880:-", "formattedTotalPrice": "36227:-", "points": 0, "credits": 0, "pricePerPassengerType": [{"id": 1, "type": "ADT", "numberCount": 1, "price": {"currency": "SEK", "basePrice": 34347.0, "totalTax": 1880.0, "totalPrice": 36227.0, "formattedBasePrice": "34347:-", "formattedTotalTax": "1880:-", "formattedTotalPrice": "36227:-", "points": 0, "credits": 0}}]}, "fares": [{"segmentId": "11", "fareClass": "CDKOW", "bookingClass": "C", "avlSeats": 9}], "fareKey": "C", "flyingToOrOverRussia": true}}}}, "PLUS": {"SAS PLUS": {"products": {"O_2": {"productName": "SAS PLUS", "productCode": "PREMC", "lowestFare": true, "recommendations": [4], "price": {"currency": "SEK", "basePrice": 20040.0, "totalTax": 1770.0, "totalPrice": 21810.0, "formattedBasePrice": "20040:-", "formattedTotalTax": "1770:-", "formattedTotalPrice": "21810:-", "points": 0, "credits": 0, "pricePerPassengerType": [{"id": 1, "type": "ADT", "numberCount": 1, "price": {"currency": "SEK", "basePrice": 20040.0, "totalTax": 1770.0, "totalPrice": 21810.0, "formattedBasePrice": "20040:-", "formattedTotalTax": "1770:-", "formattedTotalPrice": "21810:-", "points": 0, "credits": 0}}]}, "fares": [{"segmentId": "11", "fareClass": "YDKOW", "bookingClass": "Y", "avlSeats": 9}], "fareKey": "Y", "flyingToOrOverRussia": true}}}}}, "lowestFares": {"GO": {"price": "13242:-", "product": "SAS GO FLEX", "productId": "O_1", "avlSeats": 9, "points": 0.0}, "BUSINESS": {"price": "36227:-", "product": "SAS BUSINESS", "productId": "O_3", "avlSeats": 9, "points": 0.0}, "PLUS": {"price": "21810:-", "product": "SAS PLUS", "productId": "O_2", "avlSeats": 9, "points": 0.0}}}, "F0": {"id": 0, "origin": {"code": "CPH", "name": "Kastrup"}, "destination": {"code": "PVG", "name": "Pudong  "}, "originCountry": {"code": "DK", "name": "Denmark"}, "destinationCountry": {"code": "CN", "name": "China"}, "originCity": {"code": "CPH", "name": "Copenhagen"}, "destinationCity": {"code": "SHA", "name": "Shanghai"}, "connectionDuration": "14:05:00", "startTimeInLocal": "2019-10-02T18:10:00.000+02:00", "startTimeInGmt": "2019-10-02T16:10:00.000Z", "endTimeInLocal": "2019-10-03T14:15:00.000+08:00", "endTimeInGmt": "2019-10-03T06:15:00.000Z", "stops": 1, "via": [{"code": "AMS", "name": "Schiphol ", "haltDuration": "01:50:00"}], "segments": [{"id": 11, "arrivalDateTimeInLocal": "2019-10-02T19:35:00.000+02:00", "arrivalDateTimeInGmt": "2019-10-02T17:35:00.000Z", "departureTerminal": "3", "departureDateTimeInLocal": "2019-10-02T18:10:00.000+02:00", "departureDateTimeInGmt": "2019-10-02T16:10:00.000Z", "departureAirport": {"code": "CPH", "name": "Kastrup"}, "arrivalAirport": {"code": "AMS", "name": "Schiphol "}, "departureCity": {"code": "CPH", "name": "Copenhagen"}, "arrivalCity": {"code": "AMS", "name": "Amsterdam"}, "departureCountry": {"code": "DK", "name": "Denmark"}, "arrivalCountry": {"code": "NL", "name": "Netherlands"}, "airCraft": {"code": "32A", "name": "Airbus Industrie A320 Sharklets"}, "flightNumber": "553", "duration": "01:25:00", "marketingCarrier": {"code": "SK", "name": "Scandinavian Airlines"}, "onTimePerformance": 0.0, "miles": 0, "numberOfStops": 0}, {"id": 12, "arrivalTerminal": "1", "arrivalDateTimeInLocal": "2019-10-03T14:15:00.000+08:00", "arrivalDateTimeInGmt": "2019-10-03T06:15:00.000Z", "departureDateTimeInLocal": "2019-10-02T21:25:00.000+02:00", "departureDateTimeInGmt": "2019-10-02T19:25:00.000Z", "departureAirport": {"code": "AMS", "name": "Schiphol "}, "arrivalAirport": {"code": "PVG", "name": "Pudong  "}, "departureCity": {"code": "AMS", "name": "Amsterdam"}, "arrivalCity": {"code": "SHA", "name": "Shanghai"}, "departureCountry": {"code": "NL", "name": "Netherlands"}, "arrivalCountry": {"code": "CN", "name": "China"}, "airCraft": {"code": "777", "name": "Boeing 777-200/300"}, "flightNumber": "8272", "duration": "10:50:00", "marketingCarrier": {"code": "MU", "name": "China Eastern Airlines"}, "operatingCarrier": {"code": "KL", "name": "KLM Royal Dutch Airlines"}, "onTimePerformance": 0.0, "miles": 0, "numberOfStops": 0}], "isSoldOut": true}, "F1": {"id": 1, "origin": {"code": "CPH", "name": "Kastrup"}, "destination": {"code": "PVG", "name": "Pudong  "}, "originCountry": {"code": "DK", "name": "Denmark"}, "destinationCountry": {"code": "CN", "name": "China"}, "originCity": {"code": "CPH", "name": "Copenhagen"}, "destinationCity": {"code": "SHA", "name": "Shanghai"}, "connectionDuration": "16:15:00", "startTimeInLocal": "2019-10-02T17:05:00.000+02:00", "startTimeInGmt": "2019-10-02T15:05:00.000Z", "endTimeInLocal": "2019-10-03T15:20:00.000+08:00", "endTimeInGmt": "2019-10-03T07:20:00.000Z", "stops": 2, "via": [{"code": "ARN", "name": "Arlanda", "haltDuration": "00:50:00"}, {"code": "PEK", "name": "Capital ", "haltDuration": "03:10:00"}], "segments": [{"id": 11, "arrivalTerminal": "5", "arrivalDateTimeInLocal": "2019-10-02T18:20:00.000+02:00", "arrivalDateTimeInGmt": "2019-10-02T16:20:00.000Z", "departureTerminal": "3", "departureDateTimeInLocal": "2019-10-02T17:05:00.000+02:00", "departureDateTimeInGmt": "2019-10-02T15:05:00.000Z", "departureAirport": {"code": "CPH", "name": "Kastrup"}, "arrivalAirport": {"code": "ARN", "name": "Arlanda"}, "departureCity": {"code": "CPH", "name": "Copenhagen"}, "arrivalCity": {"code": "STO", "name": "Stockholm"}, "departureCountry": {"code": "DK", "name": "Denmark"}, "arrivalCountry": {"code": "SE", "name": "Sweden"}, "airCraft": {"code": "32A", "name": "Airbus Industrie A320 Sharklets"}, "flightNumber": "1408", "duration": "01:15:00", "marketingCarrier": {"code": "SK", "name": "Scandinavian Airlines"}, "onTimePerformance": 0.0, "miles": 0, "numberOfStops": 0}, {"id": 12, "arrivalTerminal": "3", "arrivalDateTimeInLocal": "2019-10-03T09:45:00.000+08:00", "arrivalDateTimeInGmt": "2019-10-03T01:45:00.000Z", "departureTerminal": "5", "departureDateTimeInLocal": "2019-10-02T19:10:00.000+02:00", "departureDateTimeInGmt": "2019-10-02T17:10:00.000Z", "departureAirport": {"code": "ARN", "name": "Arlanda"}, "arrivalAirport": {"code": "PEK", "name": "Capital "}, "departureCity": {"code": "STO", "name": "Stockholm"}, "arrivalCity": {"code": "BJS", "name": "Beijing"}, "departureCountry": {"code": "SE", "name": "Sweden"}, "arrivalCountry": {"code": "CN", "name": "China"}, "airCraft": {"code": "333", "name": "Airbus Industrie A330-300"}, "flightNumber": "9512", "duration": "08:35:00", "marketingCarrier": {"code": "SK", "name": "Scandinavian Airlines"}, "operatingCarrier": {"code": "CA", "name": "Air China"}, "onTimePerformance": 0.0, "miles": 0, "numberOfStops": 0}, {"id": 13, "arrivalTerminal": "1", "arrivalDateTimeInLocal": "2019-10-03T15:20:00.000+08:00", "arrivalDateTimeInGmt": "2019-10-03T07:20:00.000Z", "departureTerminal": "2", "departureDateTimeInLocal": "2019-10-03T12:55:00.000+08:00", "departureDateTimeInGmt": "2019-10-03T04:55:00.000Z", "departureAirport": {"code": "PEK", "name": "Capital "}, "arrivalAirport": {"code": "PVG", "name": "Pudong  "}, "departureCity": {"code": "BJS", "name": "Beijing"}, "arrivalCity": {"code": "SHA", "name": "Shanghai"}, "departureCountry": {"code": "CN", "name": "China"}, "arrivalCountry": {"code": "CN", "name": "China"}, "airCraft": {"code": "321", "name": "Airbus Industrie A321"}, "flightNumber": "271", "duration": "02:25:00", "marketingCarrier": {"code": "MU", "name": "China Eastern Airlines"}, "onTimePerformance": 0.0, "miles": 0, "numberOfStops": 0}], "isSoldOut": true}, "F2": {"id": 2, "origin": {"code": "CPH", "name": "Kastrup"}, "destination": {"code": "PVG", "name": "Pudong  "}, "originCountry": {"code": "DK", "name": "Denmark"}, "destinationCountry": {"code": "CN", "name": "China"}, "originCity": {"code": "CPH", "name": "Copenhagen"}, "destinationCity": {"code": "SHA", "name": "Shanghai"}, "connectionDuration": "25:05:00", "startTimeInLocal": "2019-10-02T21:15:00.000+02:00", "startTimeInGmt": "2019-10-02T19:15:00.000Z", "endTimeInLocal": "2019-10-04T04:20:00.000+08:00", "endTimeInGmt": "2019-10-03T20:20:00.000Z", "stops": 2, "via": [{"code": "MUC", "name": "Franz Josef Strauss ", "haltDuration": "07:25:00"}, {"code": "ARN", "name": "Arlanda", "haltDuration": "04:05:00"}], "segments": [{"id": 11, "arrivalTerminal": "2", "arrivalDateTimeInLocal": "2019-10-02T22:50:00.000+02:00", "arrivalDateTimeInGmt": "2019-10-02T20:50:00.000Z", "departureTerminal": "3", "departureDateTimeInLocal": "2019-10-02T21:15:00.000+02:00", "departureDateTimeInGmt": "2019-10-02T19:15:00.000Z", "departureAirport": {"code": "CPH", "name": "Kastrup"}, "arrivalAirport": {"code": "MUC", "name": "Franz Josef Strauss "}, "departureCity": {"code": "CPH", "name": "Copenhagen"}, "arrivalCity": {"code": "MUC", "name": "Munich"}, "departureCountry": {"code": "DK", "name": "Denmark"}, "arrivalCountry": {"code": "DE", "name": "Germany"}, "airCraft": {"code": "CR9", "name": "Canadair Regional Jet 900"}, "flightNumber": "2439", "duration": "01:35:00", "marketingCarrier": {"code": "LH", "name": "Lufthansa"}, "operatingCarrier": {"code": "CL", "name": "Lufthansa Cityline"}, "onTimePerformance": 0.0, "miles": 0, "numberOfStops": 0}, {"id": 12, "arrivalTerminal": "5", "arrivalDateTimeInLocal": "2019-10-03T08:25:00.000+02:00", "arrivalDateTimeInGmt": "2019-10-03T06:25:00.000Z", "departureTerminal": "2", "departureDateTimeInLocal": "2019-10-03T06:15:00.000+02:00", "departureDateTimeInGmt": "2019-10-03T04:15:00.000Z", "departureAirport": {"code": "MUC", "name": "Franz Josef Strauss "}, "arrivalAirport": {"code": "ARN", "name": "Arlanda"}, "departureCity": {"code": "MUC", "name": "Munich"}, "arrivalCity": {"code": "STO", "name": "Stockholm"}, "departureCountry": {"code": "DE", "name": "Germany"}, "arrivalCountry": {"code": "SE", "name": "Sweden"}, "airCraft": {"code": "CR9", "name": "Canadair Regional Jet 900"}, "flightNumber": "3624", "duration": "02:10:00", "marketingCarrier": {"code": "SK", "name": "Scandinavian Airlines"}, "onTimePerformance": 0.0, "miles": 0, "numberOfStops": 0}, {"id": 13, "arrivalTerminal": "1", "arrivalDateTimeInLocal": "2019-10-04T04:20:00.000+08:00", "arrivalDateTimeInGmt": "2019-10-03T20:20:00.000Z", "departureTerminal": "5", "departureDateTimeInLocal": "2019-10-03T12:30:00.000+02:00", "departureDateTimeInGmt": "2019-10-03T10:30:00.000Z", "departureAirport": {"code": "ARN", "name": "Arlanda"}, "arrivalAirport": {"code": "PVG", "name": "Pudong  "}, "departureCity": {"code": "STO", "name": "Stockholm"}, "arrivalCity": {"code": "SHA", "name": "Shanghai"}, "departureCountry": {"code": "SE", "name": "Sweden"}, "arrivalCountry": {"code": "CN", "name": "China"}, "airCraft": {"code": "332", "name": "Airbus Industrie A330-200"}, "flightNumber": "290", "duration": "09:50:00", "marketingCarrier": {"code": "MU", "name": "China Eastern Airlines"}, "onTimePerformance": 0.0, "miles": 0, "numberOfStops": 0}], "isSoldOut": true}}, "productInfo": {"GO": {"1": "SAS GO FLEX"}, "PLUS": {"1": "SAS PLUS"}, "BUSINESS": {"1": "SAS BUSINESS"}}, "tabsInfo": {"outboundInfo": [{"date": "2019-10-01", "price": "13242:-", "points": 0.0}, {"date": "2019-10-02", "price": "13242:-", "points": 0.0}, {"date": "2019-10-03", "price": "13242:-", "points": 0.0}]}, "currency": {"code": "SEK", "name": "Swedish Krone", "symbol": ":-", "decimalSeperator": ".", "position": "Suffix", "currencyDelimiter": "none"}, "links": [{"rel": "GetEBMSPoints", "href": "/offers/flightproducts/getAccrualPoints"}, {"rel": "FareReview", "href": "/offers/flightproducts/getFare"}, {"rel": "InitiateCheckout", "href": "/checkout/initiate"}], "regionName": "Rev Scand-Intercont", "offerId": "a390e1ab-0488-4139-bf7c-812827557084_2018-11-17", "outboundLowestFare": {"price": "13242:-", "product": "SAS GO FLEX", "productId": "O_1", "avlSeats": 9, "points": 0.0, "cabinName": "GO", "flightId": "F3"}, "isOutboundIntercontinental": true}'''

        extracted = ResponseParser(json.loads(input)).parse()
        assert extracted is None
        # assert extracted.origin == 'CPH'
        # assert extracted.destination == 'PVG'
        # assert extracted.business_seats == 0
        # assert extracted.date == datetime.date(2019, 10, 2)

    def test_parse_normal_8_seats(self):
        input = '''{"pricingType":"C","outboundFlights":{"F0":{"id":0,"origin":{"code":"CPH","name":"Kastrup"},"destination":{"code":"PEK","name":"Capital "},"originCountry":{"code":"DK","name":"Denmark"},"destinationCountry":{"code":"CN","name":"China"},"originCity":{"code":"CPH","name":"Copenhagen"},"destinationCity":{"code":"BJS","name":"Beijing"},"connectionDuration":"09:00:00","startTimeInLocal":"2019-03-05T21:05:00.000+01:00","startTimeInGmt":"2019-03-05T20:05:00.000Z","endTimeInLocal":"2019-03-06T13:05:00.000+08:00","endTimeInGmt":"2019-03-06T05:05:00.000Z","stops":0,"segments":[{"id":11,"arrivalTerminal":"3","arrivalDateTimeInLocal":"2019-03-06T13:05:00.000+08:00","arrivalDateTimeInGmt":"2019-03-06T05:05:00.000Z","departureTerminal":"3","departureDateTimeInLocal":"2019-03-05T21:05:00.000+01:00","departureDateTimeInGmt":"2019-03-05T20:05:00.000Z","departureAirport":{"code":"CPH","name":"Kastrup"},"arrivalAirport":{"code":"PEK","name":"Capital "},"departureCity":{"code":"CPH","name":"Copenhagen"},"arrivalCity":{"code":"BJS","name":"Beijing"},"departureCountry":{"code":"DK","name":"Denmark"},"arrivalCountry":{"code":"CN","name":"China"},"airCraft":{"code":"343","name":"Airbus Industrie A340-300"},"flightNumber":"995","duration":"09:00:00","marketingCarrier":{"code":"SK","name":"Scandinavian Airlines"},"onTimePerformance":0.0,"miles":0,"numberOfStops":0}],"cabins":{"GO":{"SAS GO":{"products":{"O_1":{"productName":"SAS GO","productCode":"EBSARGO","lowestFare":true,"recommendations":[3],"price":{"currency":"NOK","basePrice":0.0,"totalTax":428.0,"totalPrice":428.0,"formattedTotalTax":"428,-","formattedTotalPrice":"428,-","points":72000,"credits":0,"pricePerPassengerType":[{"id":1,"type":"ADT","numberCount":2,"price":{"currency":"NOK","basePrice":0.0,"totalTax":214.0,"totalPrice":214.0,"formattedTotalTax":"214,-","formattedTotalPrice":"214,-","points":36000,"credits":0}}]},"fares":[{"segmentId":"11","fareClass":"XBP00","bookingClass":"X","avlSeats":9}],"fareKey":"X","flyingToOrOverRussia":true}}}},"BUSINESS":{"SAS BUSINESS":{"products":{"O_3":{"productName":"SAS BUSINESS","productCode":"EBSARB","lowestFare":true,"recommendations":[5],"price":{"currency":"NOK","basePrice":0.0,"totalTax":428.0,"totalPrice":428.0,"formattedTotalTax":"428,-","formattedTotalPrice":"428,-","points":120000,"credits":0,"pricePerPassengerType":[{"id":1,"type":"ADT","numberCount":2,"price":{"currency":"NOK","basePrice":0.0,"totalTax":214.0,"totalPrice":214.0,"formattedTotalTax":"214,-","formattedTotalPrice":"214,-","points":60000,"credits":0}}]},"fares":[{"segmentId":"11","fareClass":"IBP00","bookingClass":"I","avlSeats":8}],"fareKey":"I","flyingToOrOverRussia":true}}}},"PLUS":{"SAS PLUS":{"products":{"O_2":{"productName":"SAS PLUS","productCode":"EBSARP","lowestFare":true,"recommendations":[4],"price":{"currency":"NOK","basePrice":0.0,"totalTax":428.0,"totalPrice":428.0,"formattedTotalTax":"428,-","formattedTotalPrice":"428,-","points":96000,"credits":0,"pricePerPassengerType":[{"id":1,"type":"ADT","numberCount":2,"price":{"currency":"NOK","basePrice":0.0,"totalTax":214.0,"totalPrice":214.0,"formattedTotalTax":"214,-","formattedTotalPrice":"214,-","points":48000,"credits":0}}]},"fares":[{"segmentId":"11","fareClass":"XFBP00","bookingClass":"F","avlSeats":9}],"fareKey":"F","flyingToOrOverRussia":true}}}}},"lowestFares":{"GO":{"product":"SAS GO","productId":"O_1","avlSeats":9,"points":36000.0},"BUSINESS":{"product":"SAS BUSINESS","productId":"O_3","avlSeats":8,"points":60000.0},"PLUS":{"product":"SAS PLUS","productId":"O_2","avlSeats":9,"points":48000.0}}}},"productInfo":{"GO":{"1":"SAS GO"},"BUSINESS":{"1":"SAS BUSINESS"},"PLUS":{"1":"SAS PLUS"}},"tabsInfo":{"outboundInfo":[{"date":"2019-03-04","price":"214,-","points":36000.0},{"date":"2019-03-05","price":"214,-","points":36000.0},{"date":"2019-03-06","price":"214,-","points":36000.0}]},"currency":{"code":"NOK","name":"Norwegian Krone","symbol":",-","decimalSeperator":".","position":"Suffix","currencyDelimiter":"space"},"links":[{"rel":"GetEBMSPoints","href":"/offers/flightproducts/getAccrualPoints"},{"rel":"FareReview","href":"/offers/flightproducts/getFare"},{"rel":"InitiateCheckout","href":"/checkout/initiate"}],"regionName":"EB Intercont","offerId":"8c827b20-328d-4d04-ab93-22053d1328a1_2018-11-18","outboundLowestFare":{"product":"SAS GO","productId":"O_1","avlSeats":9,"points":36000.0,"cabinName":"GO","flightId":"F0"},"isOutboundIntercontinental":true}'''

        extracted = ResponseParser(json.loads(input)).parse()
        assert extracted.origin == 'CPH'
        assert extracted.destination == 'PEK'
        assert extracted.business_seats == 8
        assert extracted.date == datetime.date(2019, 3, 5)

    def test_parse_no_business_seats(self):
        input = '''{"pricingType":"C","outboundFlights":{"F0":{"id":0,"origin":{"code":"CPH","name":"Kastrup"},"destination":{"code":"PEK","name":"Capital "},"originCountry":{"code":"DK","name":"Denmark"},"destinationCountry":{"code":"CN","name":"China"},"originCity":{"code":"CPH","name":"Copenhagen"},"destinationCity":{"code":"BJS","name":"Beijing"},"connectionDuration":"09:00:00","startTimeInLocal":"2019-03-04T21:05:00.000+01:00","startTimeInGmt":"2019-03-04T20:05:00.000Z","endTimeInLocal":"2019-03-05T13:05:00.000+08:00","endTimeInGmt":"2019-03-05T05:05:00.000Z","stops":0,"segments":[{"id":11,"arrivalTerminal":"3","arrivalDateTimeInLocal":"2019-03-05T13:05:00.000+08:00","arrivalDateTimeInGmt":"2019-03-05T05:05:00.000Z","departureTerminal":"3","departureDateTimeInLocal":"2019-03-04T21:05:00.000+01:00","departureDateTimeInGmt":"2019-03-04T20:05:00.000Z","departureAirport":{"code":"CPH","name":"Kastrup"},"arrivalAirport":{"code":"PEK","name":"Capital "},"departureCity":{"code":"CPH","name":"Copenhagen"},"arrivalCity":{"code":"BJS","name":"Beijing"},"departureCountry":{"code":"DK","name":"Denmark"},"arrivalCountry":{"code":"CN","name":"China"},"airCraft":{"code":"343","name":"Airbus Industrie A340-300"},"flightNumber":"995","duration":"09:00:00","marketingCarrier":{"code":"SK","name":"Scandinavian Airlines"},"onTimePerformance":0.0,"miles":0,"numberOfStops":0}],"cabins":{"GO":{"SAS GO":{"products":{"O_1":{"productName":"SAS GO","productCode":"EBSARGO","lowestFare":true,"recommendations":[0],"price":{"currency":"NOK","basePrice":0.0,"totalTax":428.0,"totalPrice":428.0,"formattedTotalTax":"428,-","formattedTotalPrice":"428,-","points":72000,"credits":0,"pricePerPassengerType":[{"id":1,"type":"ADT","numberCount":2,"price":{"currency":"NOK","basePrice":0.0,"totalTax":214.0,"totalPrice":214.0,"formattedTotalTax":"214,-","formattedTotalPrice":"214,-","points":36000,"credits":0}}]},"fares":[{"segmentId":"11","fareClass":"XBP00","bookingClass":"X","avlSeats":9}],"fareKey":"X","flyingToOrOverRussia":true}}}}},"lowestFares":{"GO":{"product":"SAS GO","productId":"O_1","avlSeats":9,"points":36000.0}}}},"productInfo":{"GO":{"1":"SAS GO"}},"tabsInfo":{"outboundInfo":[{"date":"2019-03-03","price":"214,-","points":36000.0},{"date":"2019-03-04","price":"214,-","points":36000.0},{"date":"2019-03-05","price":"214,-","points":36000.0}]},"currency":{"code":"NOK","name":"Norwegian Krone","symbol":",-","decimalSeperator":".","position":"Suffix","currencyDelimiter":"space"},"links":[{"rel":"GetEBMSPoints","href":"/offers/flightproducts/getAccrualPoints"},{"rel":"FareReview","href":"/offers/flightproducts/getFare"},{"rel":"InitiateCheckout","href":"/checkout/initiate"}],"regionName":"EB Intercont","offerId":"8a5e70ed-a3df-4756-8311-1c97d60beba9_2018-11-18","outboundLowestFare":{"product":"SAS GO","productId":"O_1","avlSeats":9,"points":36000.0,"cabinName":"GO","flightId":"F0"},"isOutboundIntercontinental":true}'''

        extracted = ResponseParser(json.loads(input)).parse()
        assert extracted.origin == 'CPH'
        assert extracted.destination == 'PEK'
        assert extracted.business_seats == 0
        assert extracted.date == datetime.date(2019, 3, 4)
